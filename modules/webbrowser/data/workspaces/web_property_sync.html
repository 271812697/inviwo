<html>
<head>
<title>Inviwo property syncing example</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="../js/inviwoapi.js"></script>

<script language="JavaScript">
// Initialize Inviwo API so that we can use it to synchronize properties
var inviwo = new InviwoAPI();
</script>
<style>
.selectionList {
  background-color: white;
  overflow-y: scroll;
  max-height: 10em;
  width: 18em;
}

.selectionElement {
  font-family: 'Arial', sans-serif;
  font-size: 0.9em;
  border: 1px solid white;
}

.selectionElement:hover {
  cursor: pointer;
  border: 1px solid #ccc;
}

.selectedElement {
  background-color: #0078d7;
  color: white;
}

</style>
</head>
<body>
<h3>HTML<->Inviwo synchronization (javascript & JSON)</h3>
<div class="slidecontainer">
  <p>Range (line width)<input type="range" min="1" max="100" value="50" class="slider" id="ordinalProperty">
  <span id="ordinalPropertyValue"></span></p>
</div>
  <p><input type="button" value="Button" id="buttonProperty" onclick="inviwo.setProperty('Background.switchColors', {pressButton: true})"></p>
  <p>Checkbox (enable text)<input type="checkbox" value="Checkbox" id="boolProperty" onchange="inviwo.setProperty('TextOverlay.enable', {value: this.checked})"></p>
  <p>Text <input type="text" id="stringProperty" value="not changed" oninput="inviwo.setProperty('TextOverlay.text', {value: this.value})" ></p>
  <br></br>
  <p>Option property<div class="selectionList" id="shadingMode">
  </div>
<script>
// Setup the selectionList to highlight the clicked/selected element.
function updateClickableLists() {
	$(".selectionElement").on("click", function() {
		$(this).parent().children().removeClass("selectedElement");
		$(this).addClass("selectedElement");
	});
}
updateClickableLists();
var slider = document.getElementById("ordinalProperty");
var ordinalPropertyValue = document.getElementById("ordinalPropertyValue");

slider.oninput = function() {
	inviwo.setProperty("LineRenderer.lineWidth", {value: Number(this.value)});
    ordinalPropertyValue.innerHTML = this.value;
}

function syncOrdinal(prop) { 
	inviwo.syncRange("ordinalProperty", prop); 
	ordinalPropertyValue.innerHTML = prop.value;
} 
function syncCheckbox(prop) { inviwo.syncCheckbox("boolProperty", prop); } 
function syncString(prop) { inviwo.syncStringInput("stringProperty", prop); } 
// Update html inputs when corresponding Inviwo properties change
inviwo.subscribe("LineRenderer.lineWidth", syncOrdinal); 
inviwo.subscribe("TextOverlay.enable", syncCheckbox);
inviwo.subscribe("TextOverlay.text", syncString);

function syncOption(prop) { 
	var path = "VolumeRaycaster.lighting.shadingMode";
	var options = "";
	for (var i in prop["options"]){
		var option = prop["options"][i];
		options += "Name: " + option["name"] + ", value:" + option["value"]+ ", id:" + option["id"] + "\n";
    }
	console.log("Hello option property, selected value: " + prop["value"] + "\n selected index: " + prop["selectedIndex"] + "\n Options: " + options );
	var htmlId = "shadingMode";
	var property = document.getElementById(htmlId);
	var optionIndex = 0;
	for (var i in prop["options"]) {
		var option = prop["options"][i];

		var optionId = htmlId + option["id"];
		var oldOption = document.getElementById(optionId);

		var optionDiv = document.createElement("div");
		var optionValue = document.createElement("option");
		optionValue.value = optionIndex;
		optionValue.style.visibility = "hidden";
		optionDiv.appendChild(optionValue);

		if (i == prop["selectedIndex"]) {
			optionDiv.className = "selectionElement selectedElement";
		} else {
			optionDiv.className = "selectionElement";
		}
		optionDiv.innerHTML = option["name"];
		optionDiv.id = optionId;
		optionDiv.onclick = function () {
			console.log("Setting value: " + Number(this.childNodes[0].nodeValue);
			inviwo.setProperty(path, {selectedIndex: Number(this.childNodes[0].nodeValue)});
		};
		if (oldOption) {
			property.replaceChild(optionDiv, oldOption);
		} else {
			property.appendChild(optionDiv);
		}
		optionIndex++;
	}
	updateClickableLists();

} 
inviwo.subscribe("VolumeRaycaster.lighting.shadingMode", syncOption); 

inviwo.getProperty("CubeProxyGeometry.clipX", function(prop) {
    for (var key in prop){
        var attrName = key;
        var attrValue = prop[key];
        console.log("Hello MinMaxProperty " + attrName + ": " + attrValue);
    }
});



</script>
</body>
</html>
